\definecolor{shadecolor}{rgb}{0.9,0.9,0.9}
\definecolor{titlecolor}{rgb}{0.3,0.3,0.3}
\definecolor{titleborder}{rgb}{0.6,0.6,0.6}
\usepackage{framed}

\usepackage{accsupp}
\newcommand{\noncopynumber}[1]{
    \BeginAccSupp{method=escape,ActualText={}}
    #1
    \EndAccSupp{}
}

\usepackage{listings}
\lstset {
    basicstyle=\ttfamily,
    breaklines=true,
    numbers=left,
    numberstyle=\tiny\noncopynumber,
    numberblanklines=false,
    columns=flexible,
}
\definecolor{lightblue}{HTML}{006699}
\definecolor{lightgreen}{HTML}{669900}
\definecolor{bluegreen}{HTML}{33997e}

\lstset{
    keywordstyle=\color{lightblue}\bfseries,
    identifierstyle=\color{black},
    commentstyle=\color{bluegreen}\ttfamily,
    stringstyle=\color{lightgreen}\ttfamily,
    showstringspaces=false,
    upquote=true,
    columns=fullflexible
}

\lstdefinelanguage{docker}{
    keywords={FROM, RUN, COPY, ADD, ENTRYPOINT, CMD,  ENV, ARG, WORKDIR, EXPOSE, LABEL, USER, VOLUME, STOPSIGNAL, ONBUILD, MAINTAINER},
    sensitive=false,
    comment=[l]{\#},
    morestring=[b]',
    morestring=[b]"
}

\lstdefinelanguage{docker-compose}{
    keywords={image, environment, ports, container_name, ports, links, build, services, version, expose, restart, depends_on, env_file, expose, command},
    sensitive=false,
    comment=[l]{\#},
    morestring=[b]',
    morestring=[b]"
}

\lstdefinelanguage{shell}{
    otherkeywords={>>},
    sensitive=false,
    comment=[l]{\#},
    morestring=[b]',
    morestring=[b]"
}

\definecolor{lightbule}{HTML}{006699}
\definecolor{lightgreen}{HTML}{669900}
\definecolor{bluegreen}{HTML}{33997e}
\lstdefinelanguage{Gherkin}{
	morekeywords = [1]{
		Feature,
	},
  morekeywords = [2]{
		Scenario,
	},
  morekeywords = [3]{
		Given,
		When,
		Then,
		And,
		But,
		Background,
		Scenario Outline,
		Examples
	},
  keywordstyle = [1]\color{lightgreen},
  keywordstyle = [2]\color{lightbule},
  keywordstyle = [3]\color{bluegreen},
	sensitive=true,
	morecomment=[l]{\#},
	morestring=[b]",
	morestring=[b]'
}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    showstringspaces=false,
    breaklines=true,
    literate=
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

% https://github.com/aytchell/latex-listings-protobuf/blob/master/protobuf/lang.sty
\lstdefinelanguage{protobuf}{%
    sensitive=true,%
    morecomment=[l]{//},%
    morecomment=[s]{/*}{*/},%
    morestring=[b]{"},%
    % For the keywords of Protocol Buffers
    % see https://developers.google.com/protocol-buffers/docs/proto
    morekeywords={enum,oneof,map,syntax,public,import,option,package,message,%
        group,optional,required,repeated,default,reserved,extend,extensions,%
        to,max,service,rpc,returns,true,false},%
    % Basic types
    % see https://developers.google.com/protocol-buffers/docs/proto#scalar
    morekeywords=[2]{%
        double,float,int32,int64,uint32,uint64,sint32,sint64,%
        fixed32,fixed64,sfixed32,sfixed64,bool,string,bytes},%
    % Options
    % taken from 'google/protobuf/descriptor.proto'
    morekeywords=[3]{%
        % Generic Options
        deprecated, uninterpreted_option,%
        % File Options
        java_package,java_outer_classname,java_multiple_files,%
        java_generate_equals_and_hash,java_string_check_utf8,optimize_for,%
        go_package,cc_generic_services,java_generic_services,%
        py_generic_services,cc_enable_arenas,obj_class_prefix,%
        csharp_namespace,%
        % Message Options
        message_set_wire_format,no_standard_descriptor_accessor,map_entry,%
        % Field Options
        ctype, packed,jstype,lazy,weak,%
        % Enum Options
        allow_alias}%
}

\newcommand{\bash}[1]{
\begin{shaded*}
\begin{lstlisting}[language=shell]^^J
$ #1^^J
\end{lstlisting}
\end{shaded*}}

\lstdefinelanguage{lambda}{
  morekeywords={
    if,then,else,fix,let
  },
  morekeywords={[2]int},
  otherkeywords={:},
  literate={
    {->}{{$\to$}}{2}
    {lambda}{{{\color{lightblue}\bfseries$\lambda$}}}{1}
    {type}{{$\tau$}}{1}
  },
  keepspaces,
  mathescape,
}

\lstdefinelanguage{terraform}{
    basicstyle=\normalfont\ttfamily,
    keywords = {resource, string, enum, list, terraform, provider, import, variable, output, module, data, required_providers},
    showstringspaces=false,
    breaklines=true,
    morecomment=[l]{\#},
    morestring=[b]",
}

\definecolor{bash-green}{HTML}{4e9a06}
\lstdefinelanguage{terraform-plan}{
    basicstyle=\normalfont\ttfamily,
    keywordstyle=[5]{\color{bash-green}\bfseries},
    commentstyle={\color{bash-green}\bfseries},
    keywords = {},
    otherkeywords = {+},
    morekeywords = [5]{+},
    showstringspaces=false,
    breaklines=true,
    morecomment=[l]{>>>},
    % literate={>>>}{\color{bash-green}}2 {<<<}{}2
}

\lstdefinelanguage{javascript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  ndkeywords={class, export, boolean, throw, implements, import, this},
  ndkeywordstyle=\color{darkgray}\bfseries,
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]",
}

\lstdefinestyle{clang}{
    commentstyle=\color{bluegreen},
    keywordstyle=\color{lightblue},
    stringstyle=\color{lightgreen},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    language=C
}

\lstdefinestyle{java}{
    commentstyle=\color{bluegreen},
    keywordstyle=\color{lightblue},
    stringstyle=\color{lightgreen},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    language=Java
}

\lstdefinestyle{python}{
    commentstyle=\color{bluegreen},
    keywordstyle=\color{lightblue},
    stringstyle=\color{lightgreen},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    language=python
}

\usepackage{xifthen}

\newcommand{\codeheader}[2][]{
    \ifthenelse{\isempty{#2}}{}{
        \setlength{\FrameSep}{3pt}
        {\hspace{-3pt}\ttfamily\color{titlecolor} \shaded >> cat #2 \endshaded}
    }
    \lstset{
        #1
    }\setlength{\FrameSep}{3pt}
    \ifthenelse{\isempty{#2}}{}{
        \vspace{-\baselineskip}
        \vspace{-\baselineskip}
    }
}

\lstnewenvironment{code}[2][]{
    \codeheader[#1]{#2}
    \shaded}
    {\endshaded}

\newcommand{\codefile}[3][]{
    \codeheader[]{#2}
    \shaded
    \lstinputlisting[#1]{#3}
    \endshaded
}

\newcommand{\codeline}[3][]{
    \codeheader[]{#2}
    \shaded
    \lstinline[#1]{#3}
    \endshaded
}
